<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Northwoods Events</title>
<style>
body{font-family:system-ui,Arial,sans-serif;margin:20px}
table{border-collapse:collapse;width:100%} th,td{border:1px solid #ddd;padding:8px}
th{background:#f6f6f6;text-align:left}
.badge{display:inline-block;padding:2px 6px;border:1px solid #ccc;border-radius:12px;margin-left:8px;font-size:.8em}
#status{margin:10px 0;padding:8px;border:1px solid #ddd;background:#fafafa}
</style></head><body>
<h1>Northwoods Events <span id="count" class="badge">0</span></h1>
<div id="status">Loading…</div>
<label>Filter by source: <select id="source"></select></label>
<table id="tbl"><thead><tr><th>When</th><th>Title</th><th>Location</th><th>Source</th></tr></thead><tbody></tbody></table>
<script>
const statusBox=document.getElementById("status");
const sel=document.getElementById("source"); const tbody=document.querySelector("#tbl tbody"); const badge=document.getElementById("count");
const fmt=(s)=>s?new Date(s).toLocaleString():"";
let all=[];
function render(){
  const src=sel.value;
  const rows=(src==="__all__"?all:all.filter(e=>e.source===src));
  badge.textContent=rows.length; tbody.innerHTML="";
  rows.forEach(e=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${fmt(e.start)}</td><td>${e.title||""}</td><td>${e.location||""}</td><td>${e.source||""}</td>`;
    tbody.appendChild(tr);
  });
}
function setSources(){
  const u=[...new Set(all.map(e=>e.source).filter(Boolean))].sort();
  sel.innerHTML="<option value=__all__>All</option>"+u.map(s=>`<option>${s}</option>`).join("");
  sel.onchange=render;
}
fetch("state/events.json",{cache:"no-store"})
  .then(r=>{statusBox.textContent=`GET state/events.json → ${r.status}`; if(!r.ok) throw new Error(r.status); return r.json();})
  .then(j=>{all=Array.isArray(j)?j:(j.events||[]); setSources(); render();})
  .catch(e=>{statusBox.textContent=`Failed to load events.json: ${e}`;});
</script></body></html>
